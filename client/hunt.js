function generateSeed(){
	var e = parseInt(Math.random().toString().split(".")[1],10);
	return e.toString(16)
}

function ItemsPicker(e,t){
	this.itemTpl=Handlebars.compile($("#tpl-inv-item").html()),this.invTpl=Handlebars.compile($("#tpl-inv").html()),this.modal=new CModal,this.modal.init({altTheme:!0,large:!0}),this.confirmCallback=null,this.rValue=e,this.side=t,this.initModal()

}
function animateTextValue(e,t){e.attr("data-value")!=t&&e.animate({value:t},{step:function(e){$(this).html((e/100).toFixed(2))},complete:function(){$(this).html((t/100).toFixed(2)),$(this).attr("data-value",t)},duration:800,easing:"linear"})}const INV_CACHE_EXPIRE=432e5,MAX_REFRESH=6e4,MIN_BET_VALUE=200,JOIN_MARGIN=.1,JOIN_TIME=125,EDuelStatus={OPENING:0,OPEN:1,JOINING:2,CLOSED:3,SENT:4,ACCEPTED:5,CANCELED:6};ItemsPicker.prototype.setConfirmCallback=function(e){this.confirmCallback=e},ItemsPicker.prototype.initModal=function(){var e=this,t=this.modal,n=this.rValue;if(t.setContent(e.invTpl()),t.elem.find(".modal-footer").remove(),t.elem.find(".btn-send").on("click",function(){e.createOffer()}),t.elem.find(".btn-cancel").on("click",function(){t.hide()}),t.elem.find(".btn-refresh").on("click",function(){var t=$(this);t.button("loading"),e.fetchAndCacheInventory(function(n,i){return t.button("reset"),n?e.showMessage("danger",n):(e._clearSelected(),void e._loadInv(i))})}),t.elem.find(".btn-clear").on("click",function(){e._clearSelected()}),n){t.elem.find(".modal-title").html("Join duel");var i="ct"==e.side?"t":"ct";t.elem.find(".side-info").html('<h5>Joining as</h5> <img src="/img/'+i+'-side.png" width="32"/>');var a=.9*n,o=1.1*n,l=(a/100).toFixed(2);l+=" to ",l+=(o/100).toFixed(2),t.elem.find(".p-range").html(l)}else t.elem.find(".join-info").remove(),t.elem.find(".modal-title").html("Create duel");t.elem.find(".player-seed input").val(generateSeed()),t.show();var d='<h3 class="text-center">Loading inventory...</h3>',s=t.elem.find(".inv-content");s.html(d);var r=Date.now()-localStorage.getItem("invTs");if(r<INV_CACHE_EXPIRE){var c=JSON.parse(localStorage.getItem("inventory"));if(c)return console.log("Rendering cached inv."),e._loadInv(c)}e.fetchAndCacheInventory(function(t,n){return t?s.find("h3").html("Failed to load inventory: "+t):void e._loadInv(n)})},ItemsPicker.prototype.showMessage=function(e,t,n){var i=$("<div></div>");i.html(t),i.prop("class","alert alert-"+e),this.modal.elem.find(".status-message").html(i),setTimeout(function(){var e=$(i);n||e.fadeOut(function(){e.remove()})},1e4)},ItemsPicker.prototype.createOffer=function(){var e=this.modal,t=this.rValue,n=0,i=[],a=e.elem.find(".item.selected");if(!a.length)return this.showMessage("warning","No items selected");if(a.each(function(){var e=$(this);i.push(e.data("asset-id")),n+=parseInt(e.data("price"),10)}),t){var o=1.1*t,l=.9*t;if(n>o||n<l)return this.showMessage("warning","Your offer doesn't match the required value.")}else if(n<500)return this.showMessage("warning","The minimum bet value is 5.00");var d=e.elem.find(".player-seed input").val();if(!d.length)return this.showMessage("warning","Invalid seed length");if(!/^[a-zA-Z0-9]*$/gi.test(d))return this.showMessage("warning","Invalid seed characters: only A-Z and numbers are allowed");var s=e.elem.find('.side-info input[name="side"]:checked').val();this.confirmCallback&&this.confirmCallback(i,d,s,e.elem.find(".autocancel").is(":checked"))},ItemsPicker.prototype.renderItems=function(e){var t=this,n=$("<div></div>");return e.forEach(function(e){e.fprice=(e.price/100).toFixed(2);var i=$(t.itemTpl(e));t.isBlacklisted(e.name)&&i.addClass("blacklisted"),n.append(i)}),n},ItemsPicker.prototype.isBlacklisted=function(e){return!!/^Souvenir/gi.test(e)||(!!/^Sticker/gi.test(e)||(!!/^Graffiti/gi.test(e)||(!!/^Operation/gi.test(e)||(!!/ Case$/gi.test(e)||!!/^MLG|^ESL|^Cologne|^EMS|^Enfu|Souvenir Package$|Capsule$/gi.test(e)))))},ItemsPicker.prototype.fetchAndCacheInventory=function(e){var t=localStorage.getItem("invTs");return t&&Date.now()-t<MAX_REFRESH?e("You can only refresh once every minute"):(console.log("Fetching inventory..."),void $.ajax({method:"GET",url:"/ax/get-inventory",data:{sid:window.Application.sid},success:function(t){return t.error?e(t.error):(localStorage.setItem("invTs",Date.now()),localStorage.setItem("inventory",JSON.stringify(t.data)),void e(null,t.data))},error:function(t,n,i){e(i||n)}}))},ItemsPicker.prototype._clearSelected=function(){var e=this.modal;e.elem.find(".item.selected").removeClass("selected"),e.elem.find(".to-value").html("0.00"),e.elem.find(".to-hint").html(""),e.elem.find(".w-chances").html("--%"),e.elem.data("selected-total",0)},ItemsPicker.prototype._loadInv=function(e){var t=this,n=this.modal,i=t.renderItems(e),a=Date.now(),o=(a-localStorage.getItem("invTs"))/1e3;o=Math.floor(o/60),n.elem.find(".refresh-info").html("Last refresh: "+o+" minutes ago"),n.elem.find(".inv-content").html(i),t._bindItemsEvent()},ItemsPicker.prototype._bindItemsEvent=function(){var e=0,t=this.modal,n=this.rValue;t.elem.find(".inv-content .item").each(function(){var i=$(this);i.hasClass("blacklisted")||(i.on("click",function(){var e=$(this),i=parseInt(t.elem.data("selected-total"),10);if(e.hasClass("selected"))e.removeClass("selected"),i-=parseInt(e.data("price"),10);else{if(10==t.elem.find(".item.selected").length)return this.showMessage("warning","Cannot select more than 10 items");e.addClass("selected"),i+=parseInt(e.data("price"),10)}if(t.elem.data("selected-total",i),t.elem.find(".to-value").html((i/100).toFixed(2)).addClass("label-success"),n){t.elem.find(".w-chances").html("--%");var a=1.1*n,o=.9*n,l=t.elem.find(".to-hint"),d=t.elem.find(".to-value");l.css("font-size","smaller");var s="";if(i>a)s="+"+((i-a)/100).toFixed(2),s+=" Too high!",l.css("color","#d9534f"),d.removeClass("label-primary label-success").addClass("label-danger");else if(i<o&&0!=i)s=((i-o)/100).toFixed(2),s+=" Too low!",l.css("color","#6495ED"),d.removeClass("label-primary label-success").addClass("label-danger");else if(0==i)d.removeClass("label-success label-danger").addClass("label-primary");else{var r=50*(i/n);t.elem.find(".w-chances").html(r.toFixed(2)+"%"),l.css("color","#32CD32"),d.removeClass("label-primary label-danger").addClass("label-success")}l.html(s)}}),e+=parseInt(i.data("price"),10))}),t.elem.find(".t-value").html((e/100).toFixed(2)),t.elem.data("total",e),t.elem.data("selected-total",0)};var DuelUI={ctn:null,socket:null,inventory:null,inventoryDate:null,rtpl:null,init:function(e,t){this.ctn=e,this.socket=t,this.rtpl=Handlebars.compile($("#tpl-r-duel").html());var n=this;this.ctn.find(".btn-create").on("click",function(){n.createRound()}),this.ctn.find(".btn-history").on("click",function(){n.socket.emit("history")}),setInterval(function(){n.updateUI()},1e3)},updateUI:function(){var e=0,t=0;$(".rounds .duel").each(function(){var n=parseInt($(this).data("tvalue"),10);e+=n,$(this).data("c-id")==window.Application.sid&&(t+=n)}),animateTextValue($("#duel-game-ui .total"),e);var n=$("#duel-game-ui .current-bets");t?(animateTextValue(n,t),n.html((t/100).toFixed(2))):(n.html("-"),n.data("value",0)),$("#duel-game-ui .nbr-round").html($(".rounds .duel").length)},clearUI:function(){this.ctn.find(".rounds tbody").html("")},render:function(e){var t=this;if(e.total_rvalue=e.c_value,e.join_min=(.9*e.c_value/100).toFixed(2),e.join_max=(1.1*e.c_value/100).toFixed(2),e.fc_value=e.c_value/100,e.c_items.forEach(function(e){e.fprice=(e.price/100).toFixed(2)}),e.j_items){var n=0;e.j_items.forEach(function(e){e.fprice=(e.price/100).toFixed(2),n+=e.price}),e.total_rvalue+=n}e.total_rvalue=e.total_rvalue,e.total_frvalue=(e.total_rvalue/100).toFixed(2),e.c_items_count=e.c_items.length,e.c_items_extra=e.c_items.length>5?e.c_items.length-5:void 0,e.c_items=e.c_items.splice(0,5);var i=$(this.rtpl(e)),a=/^â˜…/i,o=/^StatTrak/i,l=/^Souvenir/i;i.find(".item").each(function(){var e=$(this),t=e.attr("title");a.test(t)?e.addClass("knife"):o.test(t)?e.addClass("stattrak"):l.test(t)?e.addClass("souvenir"):parseInt(e.data("price"),10)>1e4&&e.addClass("hightier")});var d=window.Application.sid,s=i.find(".btn-join");return d!=e.created_by.steam_id?s.on("click",function(){console.log(e.round_id),t.joinRound(e.round_id)}):s.prop("disabled",!0),e.end_date&&i.find(".btn-join").remove(),i.find(".btn-details").on("click",function(){console.log("Requesting round details",e.round_id),t.socket.emit("getRound",e.round_id)}),i},appendRound:function(e){var t=e.data("c-id")==window.Application.sid?DuelUI.ctn.find(".rounds tbody.own"):DuelUI.ctn.find(".rounds tbody.others"),n=parseInt(e.data("value"),10);if(!t.find(".duel").length)return t.append(e),void setTimeout(function(){e.addClass("in")},0);t.find(".duel").each(function(){var t=$(this),i=parseInt(t.data("value"),10);if(n>i)return t.before(e),!1}),t.find(e).length||t.append(e),setTimeout(function(){e.addClass("in")},0);var i=e.data("rid");$('.duel-details [data-rid="'+i+'"]').length&&this.socket.emit("getRound",i)},initTimer:function(e,t){if(!t.j_join_on)return void e.find(".duel-status").html('<span style="color: #2ecc71;">Open</span>');var n=Math.ceil((t.now-t.j_join_on)/1e3),i=JOIN_TIME-n;e.find(".btn-join").prop("disabled",!0).hide();var a=e.find(".duel-status").html(""),o=$("<div></div>");a.append(o),o.countdown360({radius:19,seconds:i,strokeStyle:"#df4400",fillStyle:"#fe7234",fontColor:"#fff",strokeWidth:4,fontSize:12,smooth:!0,label:[],autostart:!0})},showDetails:function(e){var t=this,n=Handlebars.compile($("#tpl-duel-details").html());if(e.created_by.level=e.created_by.level?e.created_by.level:0,e.c_fvalue=(e.c_value/100).toFixed(2),e.c_items.forEach(function(e){e.fprice=(e.price/100).toFixed(2)}),e.c_odds="--%",e.j_items){e.joined_by.level=e.joined_by.level?e.joined_by.level:0,e.j_fvalue=(e.j_value/100).toFixed(2),e.j_items.forEach(function(e){e.fprice=(e.price/100).toFixed(2)});var i=e.j_value+e.c_value;e.c_odds=(100*e.c_value/i).toFixed(2)+"%",e.j_odds=(100*e.j_value/i).toFixed(2)+"%"}var a=$(n(e));"ct"==e.created_by.side?(a.find(".cblock .profile").addClass("ctside"),a.find(".jblock .profile").addClass("tside")):(a.find(".cblock .profile").addClass("tside"),a.find(".jblock .profile").addClass("ctside"));var o=getLevelClass(e.created_by.level);a.find(".cblock .p-level").css("background-color",o.bg).css("color",o.txt),e.joined_by&&(o=getLevelClass(e.joined_by.level),a.find(".jblock .p-level").css("background-color",o.bg).css("color",o.txt));var l=$('.duel-details[data-rid="'+e.round_id+'"]');if(l.length){var d=l.closest(".modal-body").html(a);return t.updateModal(d,e)}var s=new CModal;s.init({altTheme:!0,isConfirm:!1}),s.elem.find(".modal-header").remove(),s.setContent(a),s.show(),t.updateModal(s.elem,e)},updateModalWinner:function(e,t,n){var i=e.find(".cblock").data("side"),a=t?i:"ct"==i?"t":"ct",o=$("<div></div>");e.find(".duel-status").html(o),o.addClass("wanim wanim-"+a),setTimeout(function(){t?(e.find(".cblock").addClass("won"),e.find(".jblock").addClass("lost")):(e.find(".cblock").addClass("lost"),e.find(".jblock").addClass("won"));var i=$("<p></p>");i.addClass("text-center").html("Roll: "+n),i.css("font-size","0.7em"),e.find(".dt-status").append(i)},4300)},updateModal:function(e,t){switch(t.status){case EDuelStatus.JOINING:DuelUI.initTimer(e,t);break;case EDuelStatus.CLOSED:case EDuelStatus.SENT:case EDuelStatus.ACCEPTED:e.find(".jblock .items").removeClass("hide-items");var n=new Date(t.now),i=new Date(t.end_date),a=n.getTime()-i.getTime();console.log("Delta on modal win:",a);var o=t.winner_id==t.created_by.steam_id;if(a>8e3)return DuelUI.updateModalWinner(e,o,t.roll);var l=e.find(".duel-status");l.html("");var d=$("<div></div>");l.append(d),d.countdown360({radius:19,seconds:8-Math.floor(a/1e3),strokeStyle:"#049700",fillStyle:"#05c100",fontColor:"#fff",strokeWidth:4,fontSize:12,smooth:!0,label:[],autostart:!0,onComplete:function(){DuelUI.updateModalWinner(e,o,t.roll)}})}},createRound:function(){if(!window.Application||!window.Application.sid)return document.location="/auth";var e=this,t=new ItemsPicker;t.setConfirmCallback(function(t,n,i,a){var o=this.modal;o.elem.find(".btn-send").button("loading"),this.showMessage("info","Creating round with seed <strong>"+n+"</strong>... please wait."),setTimeout(function(){e.socket.emit("createRound",{asset_ids:t,seed:n,side:i,auto_cancel:a})},2e3),setTimeout(function(){o.hide()},7e3)})},joinRound:function(e){if(!window.Application||!window.Application.sid)return document.location="/auth";var t=this,n=t.ctn.find('.duel[data-rid="'+e+'"]');if(!n.length)return console.log("invalid elem");if(n.data("status")!=EDuelStatus.OPEN)return console.log("invalid status");var i=parseInt(n.data("value"),10),a=new ItemsPicker(i,n.data("side"));a.modal.elem.find(".autocancel").parent().remove(),a.setConfirmCallback(function(n,i){var a=this.modal;a.elem.find(".btn-send").button("loading"),this.showMessage("info","Joining round with seed <strong>"+i+"</strong>... please wait."),setTimeout(function(){t.socket.emit("joinRound",{round_id:e,asset_ids:n,seed:i})},5e3),setTimeout(function(){a.hide()},7e3)})},closeRow:function(e,t){var n,i=e.data("c-id"),a=i==t.winner_id?t.created_by:t.joined_by,o=t.created_by.side,l=e.find(".duel-status");n=i==t.winner_id?o+"-side":"t"==o?"ct-side":"t-side";var d='<div class="duel-winner '+n+'">';d+='<div class="c-profile-wrp wanim-row"><img src="'+a.avatar+'"/>',d+="</div></div>",l.html(d),setTimeout(function(){e.removeClass("in").addClass("out"),setTimeout(function(){e.remove()},1250)},7e4)},closeRound:function(e){var t=this,n=e.round_id,i=e.winner_id,a=DuelUI.ctn.find('.duel[data-rid="'+n+'"]');if(!a.length)return console.log("Failed to close, round element doesn't exists.");var o=a.data("c-id");a.find(".btn-join").prop("disabled",!0);var l=a.find(".duel-status"),d=$('<div class="subanim"></div>');l.html(""),l.append(d),l.find(".subanim").countdown360({radius:19,seconds:10,strokeStyle:"#049700",fillStyle:"#05c100",fontColor:"#fff",strokeWidth:4,fontSize:12,smooth:!0,label:[],autoStart:!0,onComplete:function(){t.closeRow(a,e)}});var s=$('.duel-details[data-rid="'+n+'"]');if(s.length){var r=s.find(".duel-status");r.html(""),s.find(".jblock .items").removeClass("hide-items");var c=$('<div class="subanim"></div>');r.append(c),r.find(".subanim").countdown360({radius:19,seconds:8,strokeStyle:"#049700",fillStyle:"#05c100",fontColor:"#fff",strokeWidth:4,fontSize:12,smooth:!0,label:[],autostart:!0,onComplete:function(){DuelUI.updateModalWinner(s,o==i,e.roll)}})}},hide:function(){this.ctn.hide()},show:function(){this.ctn.show()}};$(function(){var e=io("//duel.csgohunt.com/realtime"),t=$("#socket-status");DuelUI.init($("#duel-game-ui"),e),e.on("connect_error",function(){DuelUI.clearUI(),DuelUI.hide(),t.attr("class","alert alert-warning").html("Connection failed").show()}),e.on("reconnect_failed",function(){DuelUI.clearUI(),DuelUI.hide(),$("#message").attr("class","alert alert-warning").html("Reconnect failed").show()}),e.on("connected",function(n){t.hide(),DuelUI.clearUI(),DuelUI.show(),n.rounds.forEach(function(e){var t=DuelUI.render(e);return DuelUI.appendRound(t),e.end_date?(DuelUI.closeRow(t,e),void console.log("Rendering closed round",e._id)):void DuelUI.initTimer(t,e)}),DuelUI.ctn.find(".item").tooltip();var i=window.Application;i.stk&&(e.emit("authenticate",{stk:i.stk,sid:i.sid}),e.emit("getMVP"))}),e.on("newRound",function(e){var t=DuelUI.render(e);DuelUI.appendRound(t),t.find(".item").tooltip(),DuelUI.initTimer(t,e)}),e.on("refresh",function(e){DuelUI.clearUI(),e.rounds.forEach(function(e){var t=DuelUI.render(e);DuelUI.appendRound(t),DuelUI.initTimer(t,e)}),DuelUI.ctn.find(".item").tooltip()}),e.on("mvp",function(e){var t=DuelUI.ctn.find(".live-info .mvp"),n=Handlebars.compile($("#mvp-tpl").html());e.name=e.name.replace(/(?!csgohunt\.com)csgo\w*\.\w*|csgo\w*\. \w*|csgo\w* \.\w*|csgo\w* \. \w*|csgo-\w*\.\w*|skinarena|failsnipe|csgoshuffle|skinsrate|ezskins\.com|loveskins\.gq|skinrush\.net|csgorigged\!com|skinsgambling\.com|www\.dotajackpots\.com/gi,""),e.name.length>16&&(e.name=e.name.substr(0,16)+"..."),e.total=e.total/100,t.html(n(e)),t.find("div").tooltip()}),e.on("removeDuel",function(e){DuelUI.ctn.find('.duel[data-rid="'+e+'"]').fadeOut(function(){$(this).remove()})}),e.on("gameError",function(e){alert(e)}),e.on("onCreateResult",function(e){var t=new CModal;if(e.error)return t.init({title:"Failed to create offer",content:e.error,altTheme:!0,isConfirm:!1}),void t.show();t.init({title:"Offer sent!",isConfirm:!1,altTheme:!0});var n="Your trade offer has been sent with the code ";n+="<strong>"+e.pin+"</strong>. You have 2 minutes to accept it!",n+='<br /><a class="btn btn-info steam-link" href="https://steamcommunity.com/tradeoffer/'+e.tradeofferid+'" target="_blank">',n+='<i class="fa fa-external-link"></i> Open the trade',n+="</a>",t.setContent(n),t.elem.attr("data-coffer-id",e.tradeofferid),t.show()}),e.on("onJoinResult",function(e){var t=new CModal;if(e.error)return t.init({title:"Failed to create offer",content:e.error,altTheme:!0,isConfirm:!1}),void t.show();t.init({title:"Offer sent!",isConfirm:!1,altTheme:!0});var n="Your trade offer has been sent with the code ";n+="<strong>"+e.pin+"</strong>. You have 2 minutes to accept it!",n+='<br /><a class="btn btn-info steam-link" href="https://steamcommunity.com/tradeoffer/'+e.tradeofferid+'" target="_blank">',n+='<i class="fa fa-external-link"></i> Open the trade',n+="</a>",t.setContent(n),t.elem.attr("data-joffer-id",e.tradeofferid),t.show()}),e.on("onJoinOfferUpdate",function(e){var t=$('.modal[data-joffer-id="'+e.tradeofferid+'"]');t.length&&(e.accepted?t.find(".modal-body").html("Offer accepted!"):t.find(".modal-body").html("Offer declined: "+e.error))}),e.on("onCreateOfferUpdate",function(e){var t=$('.modal[data-coffer-id="'+e.tradeofferid+'"]');t.length&&(e.accepted?t.find(".modal-body").html("Offer accepted!"):t.find(".modal-body").html("Offer declined: "+e.error))}),e.on("roundJoiningP0",function(t){console.log("Round free ",t);var n=$('.duel[data-rid="'+t+'"]');if(!n)return e.emit("refresh");var i=parseInt(n.data("value"));n.data("status",1),n.find(".r-value").html((i/100).toFixed(2)),n.find(".j-profile, .j-items").html(""),n.find(".d-opponent").html(""),n.find(".duel-status").html('<span style="color: #2ecc71;">Open</span>'),window.Application.sid&&n.data("cid")==window.Application.sid||n.find(".btn-join").prop("disabled",!1).show();var a=$('.duel-details[data-rid="'+t+'"]');a.length&&(a.find(".jblock").html(""),a.find(".duel-status").html(""))}),e.on("roundJoiningP1",function(t){var n=$('.duel[data-rid="'+t.round_id+'"]');if(!n.length)return e.emit("refresh");var i=DuelUI.render(t);i.addClass("in"),n.replaceWith(i),i.find(".item").tooltip(),i.find(".btn-join").prop("disabled",!0).hide();var a=i.find(".duel-status"),o=$("<div></div>");a.append(o),o.countdown360({radius:19,seconds:JOIN_TIME,strokeStyle:"#df4400",fillStyle:"#fe7234",fontColor:"#fff",strokeWidth:4,fontSize:12,smooth:!0,label:[],autostart:!0}),$('.duel-details[data-rid="'+t.round_id+'"]').length&&DuelUI.showDetails(t)}),e.on("showDetails",function(e){console.log("Got round details",e.round_id),DuelUI.showDetails(e)}),e.on("roundEnd",function(e){DuelUI.closeRound(e)}),e.on("history",function(t){var n=new CModal;n.init({title:"Last 50 rounds",altTheme:!0,isConfirm:!1,large:!0});var i=Handlebars.compile($("#tpl-history").html()),a=Handlebars.compile($("#tpl-history-row").html());if(t&&t.length){var o=$(i({})),l=o.find("tbody");t.forEach(function(t){t.total=((t.c_value+t.j_value)/100).toFixed(2),t.winner=t.winner_id==t.created_by.steam_id?t.created_by:t.joined_by,t.winner_id==t.created_by.steam_id?t.winner_side=t.created_by.side:t.winner_side="t"==t.created_by.side?"ct":"t";var n=$(a(t));n.find(".btn-replay").on("click",function(){e.emit("getRound",$(this).closest("tr").data("rid"))}),l.append(n)}),n.setContent(o)}else n.setContent("No history");n.show()}),e.on("win",function(e){var t=new CModal,n="Congratulation! You won a round valued at ";n+=(e.value/100).toFixed(2),n+=". You will soon receive an offer with the confirmation code ",n+="'"+e.pin+"'",t.init({title:"You won!",content:n,altTheme:!0,isConfirm:!1}),t.elem.find(".modal-dialog").removeClass("modal-lg"),t.show()})}),$(function(){setTimeout(function(){askTradeurl()},3e3)});
